<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chair</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
  
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
</head>
<body>
    <div id="top"><h1>Chair</h1></div>
    <div id="hook"></div>
 
    <script type="text/babel">

        var Container = React.createClass({
          handleSelect: function(name) {
            this.setState({current: name});
            this.removeName(name);
            console.log(this.children);
          },
          removeName: function(name) {
            var newList = this.state.list;
            var i = newList.indexOf(name);
            newList.splice(i, 1);
            this.setState({list: newList});
          },
          handleAddName: function(name) {
            var list = this.state.list;
            var newList = list.concat([name]);
            this.setState({list: newList});
          },
          getInitialState: function() {
            return {list: ["Peter Huycke", "Auni Ahsan"], 
                    current: "-"};
          },
          render: function() {
            return (
              <div className="container">
                <SpeakerList add={this.handleAddName} list={this.state.list} select={this.handleSelect} />
                <Current name={this.state.current} />
              </div>
            );
          }
        });

        var SpeakerList = React.createClass({
          render: function() {
            var select = this.props.select;
            var speakerNodes = this.props.list.map(function (speaker) {
              return (
                <Speaker key={speaker} name={speaker} select={select}/>
              );
            });
  
            return (
              <div className="speakerList">
                <Form add={this.props.add} />
                <hr />
                <div className="list">
                  {speakerNodes} 
                </div>
              </div>
            );
          }
        });   

        var Form = React.createClass({
          addName: function(e) {
            e.preventDefault();
            var name = this.refs.name.value.trim();
 
            if (!name) {
              return;
            }
            this.props.add(name);
            this.refs.name.value = '';
            return;
          },
          render: function() {
            return (
              <form id="form" className="form" onSubmit={this.addName}>
                <input type="text" placeholder="Name" ref="name" required/>
                <input id="add" type="submit" value="Add" />
              </form>
            );
          }
        });

        var Speaker = React.createClass({
          handleClick: function(event) {
            this.props.select(this.props.name);
          },  
          render: function() {
            return (
              <div className="speaker" onClick={this.handleClick}>
                {this.props.name}
              </div>
            );
          }
        });

        var Current = React.createClass({
          getInitialState: function() {
            return null;
          },
          render: function() {
            return (
              <div className="current">
                <span className="curName">{this.props.name}</span>
                <Timer/>
              </div>
            );
          }
        });

        var Timer = React.createClass({
          getInitialState: function() {
            return {time: 180, timer: 0};
          },
          componentWillReceiveProps: function() {
            this.setState({time: 180});
            clearInterval(this.state.timer);
          },
          startTime: function() {
            var newTime = this.state.time - 1;
            this.setState({time: newTime});
          },
          getMin: function() {
            return Math.floor(this.state.time / 60);
          },
          getSec: function() {
            var seconds = this.state.time % 60; 
            if (seconds < 10) 
              seconds = "0" + seconds;
    
            return seconds;
          },
          handleClick: function() {
            var timer = this.state.timer;
        
            if (timer == 0) { // Timer is not running, or paused
              var newTimer = setInterval(this.startTime, 1000);
              this.setState({timer: newTimer});
            } 
            else { // Timer is running
              clearInterval(this.state.timer);
              this.setState({timer: 0});
            }
          },
          render: function() {
            return (
              <div className="timer" onClick={this.handleClick}>
                <span className="time">{this.getMin()}:{this.getSec()}</span><br/>
              </div>
            ); 
          } 
        });

        ReactDOM.render(
          <Container />,
          document.getElementById('hook')
        );

    </script>

</body>
</html>
