<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chair</title>

    <!-- Style -->
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="css/awesomplete.css">
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="scripts/awesomplete.min.js"></script>
</head>
<body>
    <div id="hook"></div>
 
    <script type="text/babel">

        var Container = React.createClass({
          start: function() {
            this.timeDown();
            var newTimer = setInterval(this.timeDown, 1000);
            this.setState({timer: newTimer});
          },
          timeDown: function() {
            var newTime = this.state.time - 1;
            this.setState({time: newTime});
          },
          handleSelect: function(name) {
            this.setState({current: name, time: 180, timer: 0});
            clearInterval(this.state.timer);
            this.removeName(name);
          },
          removeName: function(name) {
            var newList = this.state.list;
            var i = newList.indexOf(name);
            newList.splice(i, 1);
            this.setState({list: newList});
          },
          handleAddName: function(name) {
            var list = this.state.list;
            var newList = list.concat([name]);
            this.setState({list: newList});
          },
          getInitialState: function() {
            return {list: ["Peter Huycke", "Auni Ahsan"],
                    time: 180, timer: 0, 
                    current: "~"};
          },
          render: function() {
            return (
              <div className="container">
                <div className="topbar"><h1>SpeakOut</h1></div><br/>
                <SpeakerList add={this.handleAddName} list={this.state.list} select={this.handleSelect} />
                <Current name={this.state.current} time={this.state.time} timer={this.state.timer} start={this.start}/>
              </div>
            );
          }
        });

        var SpeakerList = React.createClass({
          render: function() {
            var select = this.props.select;
            var speakerNodes = this.props.list.map(function (speaker) {
              return (
                <Speaker key={speaker} name={speaker} select={select}/>
              );
            });
  
            return (
              <div className="sidebar">
                <Form add={this.props.add} />
                <hr />
                <div className="list">
                  {speakerNodes} 
                </div>
              </div>
            );
          }
        });   

        var Form = React.createClass({
          componentDidMount: function() {
            var input = document.getElementById("input");
            var form = new Awesomplete(input, {
              minchars: 1,
              maxItems: 3,
              autoFirst: true,
              list: ["Ben Coleman", "Ryan Gomes", "Jasmine Denike", "Sania Khan", "Vere Marie Khan", "Akshan Bansal", "Ebi Agbeyegbe", "Nick Grant", "Khrystyna Zhuk", "Nicole Thompson", "Angelo Gio Matteo", "Steve Warner", "Auni Ahsan", "Daman Singh", "Ryan Hume", "Jess Afonso", "Priya Kaur", "Danielle Sardella", "Danni Zuo", "Peter Zhang", "Zachary Bist", "Matthew Celestial", "Cailyn Stewart", "Nathan Gibson", "Anastasia Harovska", "Riaz Sayani-Mulji", "Rebecca Jackson", "Caitlin Pascoe", "Ilan Zimner", "Jason Lo", "Mattias Memmel", "Ernest Manalo", "John Deepak Sundara", "Nia Imara Barberousse", "Carlos Antonio Fiel", "Josh Calafato", "Raffi Dergalstanian", "Emily Xu", "Adriana Menghi", "Nasrin Gh", "Emerson Calcada", "Maheen Farrukh", "Abdulla Omari", "Falhad Mohamoud", "Farah Noori", "Hashim Yussuf", "Sana Chishti"] 
            }); 
          },
          addName: function(e) {
            e.preventDefault();
            var name = this.refs.name.value.trim();
 
            if (!name) {
              return;
            }
            this.props.add(name);
            this.refs.name.value = '';
            return;
          },
          render: function() {
            return (
              <form id="form" className="form" onSubmit={this.addName}>
                <input className="awesomplete" id="input" type="text" ref="name" required/>
              </form>
            );
          }
        });

        var Speaker = React.createClass({
          handleClick: function(e) {
            e.preventDefault();
            this.props.select(this.props.name);
          },  
          render: function() {
            return (
              <div className="speaker" onClick={this.handleClick}>
                {this.props.name}
              </div>
            );
          }
        });

        var Current = React.createClass({
          render: function() {
            return (
              <div className="current">
                <span className="curName">{this.props.name}</span>
                <Timer time={this.props.time} timer={this.props.timer} start={this.props.start} />
              </div>
            );
          }
        });

        var Timer = React.createClass({
          getMin: function() {
            return Math.floor(this.props.time / 60);
          },
          getSec: function() {
            var seconds = this.props.time % 60; 
            if (seconds < 10) {
              seconds = "0" + seconds;
            }
    
            return seconds;
          },
          handleClick: function() {
            var timer = this.props.timer;
        
            if (timer == 0) { // Timer is not running, or paused
              this.props.start();
            } 
            else { // Timer is running
              clearInterval(this.props.timer);
            }
          },
          render: function() {
            return (
              <btn className="timer" onClick={this.handleClick}>
                <span className="time">{this.getMin()}:{this.getSec()}</span><br/>
              </btn>
            ); 
          } 
        });

        ReactDOM.render(
          <Container />,
          document.getElementById('hook')
        );

    </script>

</body>
</html>
